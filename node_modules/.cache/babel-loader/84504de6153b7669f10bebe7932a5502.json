{"ast":null,"code":"import _slicedToArray from\"/Users/sylviazhang/Documents/software-development/projects/MERN/mern-frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useCallback,useState,useEffect,useContext}from\"react\";import{AuthContext}from\"../context/auth-context\";var logoutTimer;export var useAuth=function useAuth(){var _useState=useState(null),_useState2=_slicedToArray(_useState,2),token=_useState2[0],setToken=_useState2[1];var _useState3=useState({}),_useState4=_slicedToArray(_useState3,2),userId=_useState4[0],setUserId=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),tokenExpiration=_useState6[0],setTokenExpiration=_useState6[1];var auth=useContext(AuthContext);var login=useCallback(function(uid,token,expirationDate){setToken(token);setUserId(uid);var tokenExpirationDate=expirationDate||new Date(new Date().getTime()+1000*60*60);setTokenExpiration(tokenExpirationDate);localStorage.setItem('userData',JSON.stringify({userId:uid,token:token,expiration:tokenExpirationDate.toISOString()}));},[]);var logout=useCallback(function(){setToken(null);setUserId(null);localStorage.removeItem('userData');setTokenExpiration(null);},[]);useEffect(function(){if(token&&tokenExpiration){var remainingTime=tokenExpiration.getTime()-new Date().getTime();logoutTimer=setTimeout(logout,remainingTime);}else{clearTimeout(logoutTimer);}},[token,logout,tokenExpiration]);useEffect(function(){var storedData=JSON.parse(localStorage.getItem('userData'));if(storedData&&storedData.token&&new Date(storedData.expiration)>new Date()){login(storedData.userId,storedData.token,new Date(storedData.expiration));}},[login]);return{token:token,login:login,logout:logout,userId:userId};};","map":{"version":3,"names":["useCallback","useState","useEffect","useContext","AuthContext","logoutTimer","useAuth","_useState","_useState2","_slicedToArray","token","setToken","_useState3","_useState4","userId","setUserId","_useState5","_useState6","tokenExpiration","setTokenExpiration","auth","login","uid","expirationDate","tokenExpirationDate","Date","getTime","localStorage","setItem","JSON","stringify","expiration","toISOString","logout","removeItem","remainingTime","setTimeout","clearTimeout","storedData","parse","getItem"],"sources":["/Users/sylviazhang/Documents/software-development/projects/MERN/mern-frontend/src/shared/hooks/auth-hook.js"],"sourcesContent":["import { useCallback, useState, useEffect, useContext } from \"react\";\r\nimport { AuthContext } from \"../context/auth-context\";\r\n\r\nlet logoutTimer;\r\n\r\nexport const useAuth = () => {\r\n    const [token, setToken] = useState(null);\r\n  const [userId, setUserId] = useState({});\r\n  const [tokenExpiration, setTokenExpiration] = useState();\r\n  const auth = useContext(AuthContext)\r\n \r\n\r\n  const login = useCallback((uid, token, expirationDate) => {\r\n    setToken(token);\r\n    setUserId(uid);\r\n    const tokenExpirationDate = expirationDate || new Date(new Date().getTime() + 1000 * 60 *60);\r\n    setTokenExpiration(tokenExpirationDate);\r\n\r\n    localStorage.setItem('userData', JSON.stringify({userId: uid, token: token, expiration: tokenExpirationDate.toISOString() }))\r\n  }, []);\r\n\r\n  const logout = useCallback(() => {\r\n    setToken(null);\r\n    setUserId(null);\r\n    localStorage.removeItem('userData');\r\n    setTokenExpiration(null);\r\n    \r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (token && tokenExpiration) {\r\n      const remainingTime = tokenExpiration.getTime() - new Date().getTime();\r\n      logoutTimer = setTimeout(logout, remainingTime);\r\n    }else{\r\n      clearTimeout(logoutTimer);\r\n    }\r\n  }, [token, logout, tokenExpiration])\r\n\r\n  useEffect(() => {\r\n    const storedData = JSON.parse(localStorage.getItem('userData'));\r\n    if (storedData && storedData.token && new Date(storedData.expiration) > new Date()) {\r\n      login(storedData.userId, storedData.token, new Date(storedData.expiration));\r\n    }\r\n  }, [login]);\r\n\r\n  return { token, login, logout, userId };\r\n};\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}